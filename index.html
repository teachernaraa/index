<script>
  function handleResponse(data) {
    if (data.status === "ok") {
      if (data.session) {
        const script = document.createElement("script");
        script.src = data.redirect;
        document.body.appendChild(script);
      } else if (data.redirect) {
        window.location.href = data.redirect;
      }
    } else {
      alert(data.message);
    }
  }

  const params = new URLSearchParams(window.location.search);
  const token = params.get('key');

  if (!token) {
    document.body.innerHTML = "<p style='color:red'>Token олдсонгүй</p>";
  } else {
    const script = document.createElement("script");
    script.src =
      "https://script.google.com/macros/s/AKfycbzDqjMoyfqNesmHZ88d1PTZWkp_h0B9ODAm-dCHDwUI0qPLdOzw6C9AW44ZTM8HxzRH-w/exec?key=" +
      token +
      "&callback=handleResponse";
    document.body.appendChild(script);
  }
</script>
