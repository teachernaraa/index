<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Access Control</title>
</head>
<body>
  <h3>‚è≥ Token —à–∞–ª–≥–∞–∂ –±–∞–π–Ω–∞...</h3>

  <script>
    function redirectToSite(token) {
      const nonce = Math.random().toString(36).substr(2, 10); // üé≤ Random nonce
      const cbName = "cb_" + Date.now();

      // Callback function
      window[cbName] = function(response) {
        if (response.status === "ok") {
          document.body.innerHTML = "<h3>‚úÖ Access granted! Redirecting...</h3>";
          setTimeout(() => {
            window.location.href = response.url;
          }, 1000);
        } else {
          document.body.innerHTML = "<h3>‚ùå Access denied: " + response.msg + "</h3>";
        }
      };

      // JSONP call to Apps Script
      const script = document.createElement("script");
      script.src = "https://script.google.com/macros/s/AKfycbzm0SwI_b9bhyZDFWSFYdJ_-eM3pObAdcouKD4-fP6pKiob1p53XYQPO4OrkaDMy5jBNw/exec"
        + "?key=" + encodeURIComponent(token)
        + "&nonce=" + encodeURIComponent(nonce)
        + "&callback=" + cbName;

      document.body.appendChild(script);
    }

    // URL-–∞–∞—Å token —É–Ω—à–∏—Ö
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get("key");

    if (token) {
      redirectToSite(token);
    } else {
      document.body.innerHTML = "<h3>‚ùå Token –æ–ª–¥—Å–æ–Ω–≥“Ø–π</h3>";
    }
  </script>
</body>
</html>
